# Internationalization (i18n) Guide

## Overview

PDF Organizer uses Flutter's official localization system with ARB (Application Resource Bundle) files.

## Supported Languages

| Code | Language | Status |
|------|----------|--------|
| `en` | English | ✅ Complete (default) |
| `fr` | French | ✅ Complete |

## File Structure

```
lib/l10n/
├── app_en.arb              # English translations (template)
├── app_fr.arb              # French translations
├── app_localizations.dart  # Generated - DO NOT EDIT
├── app_localizations_en.dart
└── app_localizations_fr.dart
```

## Configuration

### l10n.yaml

```yaml
arb-dir: lib/l10n
template-arb-file: app_en.arb
output-localization-file: app_localizations.dart
output-class: AppLocalizations
```

### pubspec.yaml

```yaml
dependencies:
  flutter_localizations:
    sdk: flutter
  intl: any

flutter:
  generate: true
```

### main.dart

```dart
import 'package:flutter_localizations/flutter_localizations.dart';
import 'l10n/app_localizations.dart';

MaterialApp.router(
  localizationsDelegates: const [
    AppLocalizations.delegate,
    GlobalMaterialLocalizations.delegate,
    GlobalWidgetsLocalizations.delegate,
    GlobalCupertinoLocalizations.delegate,
  ],
  supportedLocales: AppLocalizations.supportedLocales,
)
```

---

## ARB File Format

### Basic String

```json
{
  "appName": "PDF Organizer",
  "@appName": {
    "description": "The name of the application"
  }
}
```

### String with Placeholder

```json
{
  "greeting": "Hello, {name}!",
  "@greeting": {
    "description": "Greeting with user name",
    "placeholders": {
      "name": {
        "type": "String",
        "example": "Alex"
      }
    }
  }
}
```

### Plural Forms

```json
{
  "itemCount": "{count, plural, =0{No items} =1{1 item} other{{count} items}}",
  "@itemCount": {
    "placeholders": {
      "count": {
        "type": "int"
      }
    }
  }
}
```

### Date/Time

```json
{
  "lastModified": "Last modified: {date}",
  "@lastModified": {
    "placeholders": {
      "date": {
        "type": "DateTime",
        "format": "yMMMd"
      }
    }
  }
}
```

---

## Usage in Code

### Basic Usage

```dart
import '../../l10n/app_localizations.dart';

@override
Widget build(BuildContext context) {
  final l10n = AppLocalizations.of(context)!;
  
  return Text(l10n.appName);
}
```

### With Placeholders

```dart
Text(l10n.greeting('Alex'))  // "Hello, Alex!"
Text(l10n.itemCount(5))       // "5 items"
```

### Outside Build Context

If you need localized strings outside a widget (e.g., in a service), pass the context or the l10n instance.

```dart
void showError(BuildContext context) {
  final l10n = AppLocalizations.of(context)!;
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text(l10n.errorMessage)),
  );
}
```

---

## Adding a New Language

### Step 1: Create ARB File

Create `lib/l10n/app_XX.arb` where XX is the locale code.

```json
{
  "@@locale": "es",
  "appName": "Organizador PDF",
  "greeting": "¡Hola, {name}!"
}
```

### Step 2: Translate All Keys

Copy all keys from `app_en.arb` and translate the values.

### Step 3: Generate

```bash
flutter gen-l10n
```

### Step 4: Verify

The app will now automatically use Spanish for devices with Spanish locale.

---

## Adding New Strings

### Step 1: Add to English (Template)

```json
// lib/l10n/app_en.arb
{
  "newFeature": "New Feature",
  "@newFeature": {
    "description": "Title for the new feature screen"
  }
}
```

### Step 2: Add to All Languages

```json
// lib/l10n/app_fr.arb
{
  "newFeature": "Nouvelle Fonctionnalité"
}
```

### Step 3: Regenerate

```bash
flutter gen-l10n
```

### Step 4: Use in Code

```dart
Text(l10n.newFeature)
```

---

## Current Translations Reference

### Navigation

| Key | English | French |
|-----|---------|--------|
| `home` | Home | Accueil |
| `files` | Files | Fichiers |
| `settings` | Settings | Paramètres |
| `tools` | Tools | Outils |

### Actions

| Key | English | French |
|-----|---------|--------|
| `scanNew` | Scan New | Scanner |
| `import` | Import | Importer |
| `export` | Export | Exporter |
| `share` | Share | Partager |

### Paywall

| Key | English | French |
|-----|---------|--------|
| `upgradeToPro` | Upgrade to Pro | Passer à Pro |
| `getLifetimeAccess` | Get Lifetime Access | Obtenir l'accès à vie |
| `restorePurchases` | Restore Purchases | Restaurer les achats |

### Onboarding

| Key | English | French |
|-----|---------|--------|
| `skip` | Skip | Passer |
| `continue_` | Continue | Continuer |
| `getStarted` | Get Started | Commencer |

---

## Testing Translations

### Force Locale (Debug)

```dart
MaterialApp.router(
  locale: const Locale('fr'),  // Force French
  // ...
)
```

### Test All Locales

```dart
void main() {
  for (final locale in AppLocalizations.supportedLocales) {
    testWidgets('Test ${locale.languageCode}', (tester) async {
      await tester.pumpWidget(
        MaterialApp(
          locale: locale,
          localizationsDelegates: AppLocalizations.localizationsDelegates,
          home: const HomeScreen(),
        ),
      );
      // Verify widgets render without errors
    });
  }
}
```

---

## Best Practices

### DO ✅

1. **Always use l10n** for user-facing text
2. **Add descriptions** in ARB files for translators
3. **Test all locales** before release
4. **Keep translations in sync** across all ARB files

### DON'T ❌

1. **Hardcode strings** in widgets
2. **Edit generated files** (`app_localizations*.dart`)
3. **Forget to run gen-l10n** after ARB changes
4. **Use string concatenation** for complex sentences

### Handling Missing Translations

If a key is missing in a language file, Flutter falls back to the template (English). Always ensure all keys are present in all ARB files.

```bash
# Find missing keys (simple check)
diff <(grep '"[a-z]' lib/l10n/app_en.arb | sort) \
     <(grep '"[a-z]' lib/l10n/app_fr.arb | sort)
```

---

## Troubleshooting

### "AppLocalizations.of(context) returns null"

Ensure `localizationsDelegates` and `supportedLocales` are set in `MaterialApp`.

### Changes Not Appearing

```bash
flutter clean
flutter pub get
flutter gen-l10n
flutter run
```

### Build Errors After Adding Key

Check that:
1. ARB files are valid JSON
2. Placeholders match between all language files
3. `flutter gen-l10n` completed successfully
